# Changelog

## [1.0.7] - 2026-02-25
### Added & Changed
- 新增汇率曲线追踪功能：通过 `/icbc_chart_add` 添加币种追踪，后台定时采集历史数据（保留最近7天）。
- 新增 `/icbc_chart` 指令：生成汇率走势折线图（含结汇价和购汇价双线）并发送给用户。
- 新增 `/icbc_chart_del`、`/icbc_chart_list` 指令：管理追踪列表和查看数据采集情况。
- 新增 `/icbc_chart_auto [on/off]` 指令：开关定时自动推送走势图，开启后每次后台采集数据时自动发送。
- 优化监控提醒文案：将"预警"改为"提醒"，语气更温和。
- 默认后台轮询间隔调整为 30 分钟。
- 新增 `matplotlib` 依赖用于图表绘制。

## [1.0.6] - 2026-02-24
### Fixed
- 修复监控提醒无法推送的问题：将会话标识从 `get_sender_id()` 改为 `unified_msg_origin`，使消息推送 API 能正确解析会话信息。

## [1.0.5] - 2026-02-21
### Added & Changed
- 增加监控重复项检查：在添加监控规则时会对比已有的币种、规则和汇率阈值，防止重复添加。
- 在成功添加监控规则后，会追加提示当前后台获取数据的间隔时间。
- 在 `icbc_list` 指令中也会追加显示监控获取时间间隔。
- 将后台默认轮询间隔频率调整为 60 分钟（原30分钟），进一步降低被风控的可能性。
- 修复 `/icbc_cron` 指令由于空格解析导致 Cron 表达式无效报错的问题。

## [1.0.4] - 2026-02-21
### Fixed
- 修复在添加监控规则时，因为异步生成器作为协程被错误 `await` 调用而引发的报错导致功能失效的问题。

## [1.0.3] - 2026-02-21
### Changed
- 调整了买入和卖出的视角为**用户视角**。现在 `/icbc_add_buy` 指代监控银行卖出价（用户买入外汇），而 `/icbc_add_sell` 指代监控银行买入价（用户卖出外汇）。
- 优化了汇率查询时的提示文字为“购汇价(用户买入)”、“结汇价(用户卖出)”，以便更好地理解。

## [1.0.2] - 2026-02-21
### Changed & Added
- 优化了汇率显示的提示语，改为更容易理解的“结汇价(银行买入)”和“购汇价(银行卖出)”。
- 将指令 `/icbc_ls` 替换为 `/icbc_list`。
- 将指令 `/icbc_rm` 替换为 `/icbc_del`。
- 将添加监控指令拆分为 `/icbc_add_buy` 和 `/icbc_add_sell` 专门监控结汇价和购汇价。
- 采用 `/icbc_cron` 对话指令替代 GUI 设定时间，并支持完整的 cron 表达式。
- 在 `icbc_help` 介绍中增加了简单易学的 cron 教程。

## [1.0.1] - 2026-02-21
### Added & Fixed
- 采用 `_conf_schema.json` 图形化配置后台刷新频率，废弃原有的频率查询和设置指令。
- 实现 `/icbc_help` 指令：获取帮助和指令一览。
- 修复并跳过 `UNSAFE_LEGACY_RENEGOTIATION_DISABLED` SSL报错问题解决 API 请求失败。

## [1.0.0] - 2026-02-21
### Added
- 初始版本发布。
- 实现 `/icbc` 指令：实时获取工商银行汇率数据。
- 实现 `/icbc_add` 和 `/icbc_rm` 指令：根据设定的阈值监控汇率波动。
- 实现 `/icbc_freq` 指令：设置后台刷新的时间间隔。
- 实现 `/icbc_ls` 指令：查看当前的监控规则列表。
- 集成 aiohttp 异步请求，遵循 AstrBot 插件开发规范。
